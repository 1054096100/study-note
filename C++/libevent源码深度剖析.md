# libevent源码深度剖析

## 1、序幕

开源高性能网络库

几乎是无处不函数指针

### 亮点

事件驱动（event-driven），高性能；

轻量级，专注于网络；

跨平台；

支持多种I/O多路复用技术；

支持I/O，定时器和信号等事件；

注册事件优先级；

## 2、Reactor模式

整个libevent本身就是一个Reactor。

Reactor释义“反应堆”，是一种**事件驱动机制**。和普通函数调用的不同之处在于：应用程序不是主动的调用某个API完成处理，而是恰恰相反，Reactor逆置了事件处理流程，应用程序需要提供相应的接口并注册到Reactor上，如果相应的事件发生，Reactor将主动调用应用程序注册的接口，这些接口又称为“**回调函数**”。使用Libevent也是想Libevent框架注册相应的事件和回调函数；当这些事件发生时，Libevent会调用这些回调函数处理相应的事件（I/O读写、定时和信号）。

### Reactor模式的优点

- 可以最大程度的避免复杂的多线程及同步问题，并且避免了多线程/进程的切换开销；
- 可扩展性，可以方便的通过增加Reactor实例个数来充分利用CPU资源；
- 可复用性，reactor框架本身与具体事件处理逻辑无关，具有很高的复用性

### Reactor模式框架

使用Reactor模型，必备的几个组件：事件源、Reactor框架、多路复用机制和事件处理程序。

- 事件源

Linux上是文件描述符，Windows上就是Socket或者Handle了，这里统一称为“句柄集”；**程序在指定的句柄上注册关心的事件**，比如I/O事件。

- event demultiplexer——事件多路分发机制

由操作系统提供的I/O多路复用机制

程序收到通知后，就可以在**非阻塞的情况下**对事件进行处理了。

-  Reactor——反应器

Reactor，是事件管理的接口，内部使用event demultiplexer注册、注销事件；并运行事件循环，当有事件进入“就绪”状态时，调用注册事件的**回调函数**处理事件。

对应到libevent中，就是event_base结构体。

- Event Handler——事件处理程序

事件处理程序提供了一组接口，每个接口对应了一种类型的事件，供Reactor在相应的事件发生时调用，执行相应的事件处理。通常它会绑定一个有效的句柄。

对应到libevent中，就是event结构体。






















































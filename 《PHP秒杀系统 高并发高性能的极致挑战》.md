# 《PHP秒杀系统 高并发高性能的极致挑战》

## 1、课程介绍

一、海量用户瞬时高并发

二、系统的高性能和良好的架构（对系统的极致优化以及良好的分布式方案）

语言：PHP

数据库：Mysql

高性能缓存：Redis。使用Redis缓存来解放数据库。增加一些**数据结构**，让程序的性能更好。

良好的系统设计：满足当前，兼顾未来

遇到的问题（遇到过亿次秒杀。需要应对更大的并发量）

单机优化

分布式方案：服务器集群的架构方案来把系统部署扩充到更大规模的服务器上。让更多的服务器资源来抗住更大的并发量。

防外挂机器（防止机器人程序）

### 系统优化

一、使用Redis缓存来解放数据库。增加一些数据结构，让程序的性能更好。

二、让页面接口静态化，

### 秒杀系统特点

一、人多商品少

二、时间短，流量高

三、外挂机器

## 2、系统环境

### CDN（内容分发网络）

实现分布式缓存，全国多节点。

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/1.PNG)

### 智能DNS

实现多线路接入

### 负载均衡LVS

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/2.PNG)

#### 大型Web集群

##### 高效稳定

因为LVS是运行在网络层的负载均衡的服务。所以在处理网络连接的方面效率会更高。所以能够支持更大规模的集群，更大量的网络请求。

##### 好处

屏蔽用户对服务器的透明性。这样用户是不知道我们部署了多少台服务器，用户只能够看到我们部署的LVS服务器对外提供的一个IP。所以服务器的规模可以非常容易地做动态调整。

### PHPRedis客户端

phpredis/Predis

## 3、系统设计

### 基本功能

#### 后台

##### 活动管理

秒杀系统的特点是时间短，是作为一个活动一期一期来进行的（例如一周两次）。

##### 商品管理

##### 订单管理

##### 日志管理

针对用户所有购买的行为需要记录下来。因为我们需要追溯这个用户是不是有问题（例如通过作弊的方法，或者通过机器人的手段重复反复的提交订单）。不管请求成功与否，都会记录下来，便于我们后续的分析。

#### 前台

商品展示/秒杀/购物车/我的订单



### 项目流程

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/3.PNG)

### 活动信息表

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/4.PNG)

### 商品信息表

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/5.PNG)

### 日志记录表

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/6.PNG)

### 问答信息表

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/7.PNG)

### 订单信息表

![](http://oklbfi1yj.bkt.clouddn.com/%E3%80%8APHP%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%20%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%9E%81%E8%87%B4%E6%8C%91%E6%88%98%E3%80%8B/8.PNG)

## 4、秒杀功能开发

### 商品页面开发

展示页面静态化（把动态页面做静态化处理）

我们把生成的静态化页面的源代码另存一份就好了，例如保存到本地的一个静态文件里面。然后再通过定时抓取动态页面，把它写到一个静态化的HTML文件里面。

## 5、单商品秒杀

### 万次秒杀

- 请求少，并发低，实现了基本功能就可以满足
- 不需要他多考虑优化方面
- 单机，Mysql数据库就可以支持
















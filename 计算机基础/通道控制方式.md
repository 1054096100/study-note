# 通道控制方式

----- 虽然DMA方式比起中断方式来已经显著地减少了CPU的干预，即已由以**字（节）**为单位的干预减少到以**数据块**为单位的干预。

但CPU每发出一条I/O指令，也只能去读/写一个连续的数据块。而当我们需要一次去**读多个数据块**且将它们分别**传送到不同的内存区域**，

或者相反时，则需由CPU分别发出**多条I/O指令**及进行**多次中断处理**才能完成。

## 1、通道控制方式的引入

---- 通道控制方式与DMA控制方式类似，也是一种以内存为中心，实现设备与内存直接交换数据的控制方式。

---- 与DMA控制方式相比，通道方式所需要的CPU干预更少，而且可以做到**一个通道控制多台设备**，从而进一步减轻了CPU负担。

---- 通道本质上是一个**简单的处理器**，专门负责输入、输出控制，具有**执行I/O指令**的能力，并通过执行**通道I/O程序**来控制I/O操作。

---- 通道的指令系统比较简单，一般只有**数据传送指令**、**设备控制指令**等。

---- I/O通道控制方式是对DMA控制方式的发展，它进一步使CPU参与到数据传输的控制减少，即把对一个数据块的读/写为单位的干预，减少

为对一组数据块的读/写及有关的控制和管理为单位的干预。同时，又可实现CPU、通道和I/O设备的并行操作，从而更有效地提高整个系统的

资源利用率。在通道控制方式中，CPU只需发出**启动指令**，指出要求通道**执行的操作**和**使用的I/O设备**，该指令就可以启动通道并使该通道从

**内存**中调出**相应的通道程序**执行。

---- 以数据输入为例：当用户进程需要数据时，CPU发出启动指令**指明要执行的I/O操作**、所使用的设备和通道。当对应通道接收到CPU发来

的启动指令后，把存放在内存中的**通道程序**读出，并执行通道程序，控制设备将**数据传送到内存中指定的区域**。

在设备进行输入的同时，CPU可以去做其他工作。当**数据传送结束**时，设备控制器向CPU发送一个**中断请求**。CPU收到中断请求后转中断处理

程序执行，中断结束后返回被中断程序。

优点：通道控制方式解决了**I/O操作的独立性**和**各部件工作的并行性**。把CPU从繁琐的输入/输出操作中解放出来。采用通道技术后，不仅能实现

CPU和通道的并行操作，而且**通道与通道之间也能实现并行操作**，**各通道上的外设也能实现并行操作**，从而可提高整个系统的效率。

缺点：由于需要更多硬件（通道处理器），因此其成本较高。通道控制方式通常应用于大型数据交互的场合。

## 2、通道程序

---- 通道是通过**执行通道程序，并与设备控制器共同实现对I/O设备的控制的**。通道程序是由一系列**通道指令**所构成的。通道指令和一般的机器

指令不同，在它的每条指令中都包含下列诸信息：

-- 1）**操作码**。操作码规定了指令所**执行的操作**，如读、写、控制等操作。

-- 2）**内存地址**。内存地址标明字符送入内存（读操作）和从内存取出（写操作）时的**内存首址**。

-- 3）**计数**。该信息表示本条指令所要读/写数据的**字节数**。

-- 4）**通道程序结束位P**。该位用于**表示通道程序是否结束**。**P=1**表示本条指令是通道程序的最后一条指令。

-- 5）**记录结束标志R**。R=0表示本通道指令与下一条指令所处理的数据是同属于一个记录；**R=1**表示这是处理**某记录的最后一条指令**。

====================================================================================================

----- 通道控制方式与DMA控制方式的区别：

1）DMA控制方式中**需要CPU**来控制所传输**数据块的大小**，传输的**内存地址**；通道控制方式中这些信息都是由通道来控制管理的。

2）一个DMA控制器对应**一台设备**与内存传递数据，而一个通道可以控制多台设备与内存的数据交换。

----- I/O通道与一般处理器的区别：I/O通道的**指令类型单一**，其所能执行的命令主要局限于与I/O操作有关的指令；**通道没有自己的内存**，通道所执行

的通道程序放在主机的内存中，也就是说**通道是与CPU共享内存的**。
# 多线程

### 多线程概念

#### 1.异步与同步

异步:多个任务操作可以同时执行适应传输数据量大，在连接过程中UI不“冻结”;<大量线程CPU超限的话会造成一种假死的状态(造成卡,但是线程还在后台执行)>

同步:代码从上到下,按顺序依次一步一步的执行,当请求的数据量小时，同步连接是一个很好的选择。UI“冻结”是它的一个缺点。

#### 2.进程与线程

进程:进程是系统中正在运行的一个程序,每一个进程都是独立的,都运行在其专用且受保护的内存空间内,通过活动监视器可以查看mac系统中所有开启的进程

线程:线程是进程的基本执行单元,进程的所有任务都在线程中执行,一个进程至少要有一条线程,当程序启动时会默认开启一条线程,这条线程被称为主线程或者UI线程

#### 3.之间关系

一个进程可以开启多条线程,每一条线程都可以执行不同的任务

#### 4.主线程

程序启动创建的线程被称为主线程

### 多线程原理

#### 1.使用多线程目的

将耗时操作放在后台去执行,待执行完成后,通知主线程更新UI

#### 2.原理

单核CPU:同一时间,CPU只能处理一个线程,换而言之,在同一时间内只有一个线程在执行

多线程同时执行:CPU快速的在多个线程间的切换;CPU调度线程的时间足够快,就造成了多线程同时执行的效果

如果线程非常多的时候:CPU会在N个线程之间切换,消耗大量的CPU资源,每一条线程调度的次数会降低,线程的执行效率也会降低

#### 3.多线程的优缺点

优点:可以适当提高程序的执行效率;提高资源的利用率(CPU,内存)

缺点:开启线程需要占用一定的内存空间(默认情况下,每一条线程都占512KB--iOS8.0后主线程默认的堆栈也是512KB)

如果开启大量的线程,会占用大量的空间,降低程序的性能,那么CPU在调度线程上的开销就越大

线程是程序逻辑思维更为复杂;比如线程间的通讯及多线程的数据共享

### 线程的状态

#### 新建

实例化线程对象

#### 就绪

向线程对象发送start消息,线程对象被加入可调度线程池等待CPU调度;detach方法和performSelectorInBackGround方法会直接实例化一个线程对象并加入可调度线程池

#### 运行

CPU负责调度可调度线程池中的任务执行

线程执行完之前,状态可能在就绪和运行之间来回切换

#### 阻塞

当满足某个预定条件时可以,可以使用休眠或锁阻塞线程执行

#### 死亡

正常死亡:线程执行完毕

非正常死亡:当满足某个条件时,在线程内部终止执行;当满足某个条件时在主线程终止线程对象





